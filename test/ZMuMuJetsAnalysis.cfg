 process ZMuMuJetsAnalysis = {

include "FWCore/MessageLogger/data/MessageLogger.cfi"
include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates2GenParticles.cfi"
include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

untracked PSet options = {
  untracked bool wantSummary = true
}

service = TFileService { 
    string fileName = "ZMuMuJetsHistosTest1.root"
}

 untracked PSet maxEvents = { 
     untracked int32 input = -1
}

 source = PoolSource {
    untracked vstring fileNames = {

'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/062CDBDF-6AA1-DC11-8E93-001617C3B5D8.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/0AA11D6D-6DA1-DC11-9A49-00304856299C.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/10FE3BDA-6AA1-DC11-BF12-000423D9863C.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/1A98727B-6CA1-DC11-BA78-00304855D4F8.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/1C6A41DA-6AA1-DC11-AD98-001617C3B65A.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/1CCE078B-71A1-DC11-BFF3-003048562956.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/2A2D6ADB-6AA1-DC11-81DB-000423D6B328.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/2C4B217B-6CA1-DC11-BB67-00304885AA2C.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/2E2650DA-6AA1-DC11-83EC-000423D6C8E6.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/3235AAE0-6AA1-DC11-A057-00304855C516.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/32C9A05D-6DA1-DC11-B8DD-001617DBD316.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/3654235B-6DA1-DC11-93E3-0016177CA778.root',
'/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/389D6C77-6CA1-DC11-BEBF-003048561844.root'

}

}
# partonFilterMin = CandViewCountFilter {
#  InputTag src = selectedPartons
#  uint32 minNumber = 1
#}

#module partonFilterMax = CandViewCountFilter {
#  InputTag src = selectedPartons
#  uint32 minNumber = 2
#}

module muonCount = CandViewCountFilter {
  InputTag src = muons
  uint32 minNumber = 2
}

module muonCount2 = CandViewCountFilter {
  InputTag src = muons
  uint32 minNumber = 3
}

 module zToMuMu = CandViewShallowCloneCombiner {
   string decay = "selectedMuons@+ selectedMuons@-"	
   string cut = "5 < mass"
   bool filter = true
}


module selectedMuons = CandViewRefSelector {
   InputTag src = muons
   string cut = "pt > 15 & abs(eta)<3"
   bool filter = true
 }

 module selectedCaloJets = CandViewRefSelector {
   InputTag src = iterativeCone5CaloJets
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module selectedGenJets = CandViewRefSelector {
   InputTag src = iterativeCone5GenJetsNoNuBSM
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }	

module selectedPartons = CandViewRefSelector {
   InputTag src = leadingPartons
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module zToMuMuMC = CandViewRefSelector {
   InputTag src = genParticles
   string cut = "pdgId=23 & status=3 & numberOfDaughters>0 & abs(daughter(0).pdgId)=13"
   bool filter = true
 }
 
  module leadingPartons =  ZMuMuJetsLeadingPartonProducer {
   InputTag src = genParticles
 }
 
 module generatorJetsMatch = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons 
   InputTag jets = isolatedGenJets
   string name = "selectedGenJets"
 }
 
 module calorimeterJetsMatch = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons
   InputTag jets = isolatedCaloJets
   string name = "selectedCaloJets"
 }
 
 module isolatedCaloJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = selectedMuons	
 InputTag jets = selectedCaloJets
 string name = "isolatedCaloJets"
  double deltar = 0.3

}

 module isolatedGenJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = selectedMuons
 InputTag jets = selectedGenJets
 string name = "isolatedGenJets"
 double deltar = 0.3

}

module moreThan0Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 1 
}

module moreThan1Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 2 
}

module moreThan2Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 3 
}

module moreThan3Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 4 
}

module moreThan4Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 5 
}

module moreThan5Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 6 
}

 module csaweightproducer = CSA07EventWeightProducer {
    InputTag src = source

    # verbosity
    untracked bool talkToMe = false  #true

    # overall luminosity normalization  (in pb-1)
    double overallLumi = 10.
 }

#module printTree = ParticleTreeDrawer {

 #   untracked bool printP4 = true
 #   untracked bool printPtEtaPhi = false
 #   untracked bool printVertex = false
 #   untracked bool printStatus = false
 #   untracked bool printIndex = false
 #   untracked vint32 status = { 3 }
# }

module allHistos = zMuMuJetsHistogrammer {
  bool hasglobalweight = false 
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos =  zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos =  zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos1Jet = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos1Jet = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos1Jet = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos2Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos2Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos2Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos3Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos3Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos3Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos4Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos4Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos4Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag genJets = isolatedGenJets
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  bool hasglobalweight = false
  InputTag weight = csaweightproducer:weight
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag matchedCaloJets = calorimeterJetsMatch
  InputTag matchedGenJets = generatorJetsMatch
  InputTag genJets = isolatedGenJets
  InputTag muons = selectedMuons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

sequence preselection = {
  genParticles,
  csaweightproducer,
  muonCount,
  muonCount2,  
  -selectedMuons,
  leadingPartons,
  -selectedPartons,
  -selectedCaloJets,
  -selectedGenJets,  
  -isolatedCaloJets,
  -isolatedGenJets, 
  -generatorJetsMatch,
  -calorimeterJetsMatch,
  #printTree,
  zToMuMu     

}

 path allEntries = {
   preselection,
   -zToMuMuMC,
   allHistos   
 }

 path signalEntries = {
   preselection,
   zToMuMuMC, 
   signalHistos
 } 

 path backgroundEntries = {
   preselection,
   !zToMuMuMC, 
   backgroundHistos
 } 


 path allEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   -zToMuMuMC,
    allHistos1Jet   
 }

 path signalEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   zToMuMuMC, 
   signalHistos1Jet
 } 

 path backgroundEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   !zToMuMuMC, 
   backgroundHistos1Jet
 } 

path allEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   -zToMuMuMC,
   allHistos2Jets   
 }

 path signalEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   zToMuMuMC, 
   signalHistos2Jets
 } 

 path backgroundEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   !zToMuMuMC, 
   backgroundHistos2Jets
 }

path allEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   -zToMuMuMC,
   allHistos3Jets   
 }

 path signalEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   zToMuMuMC, 
   signalHistos3Jets
 } 

 path backgroundEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   !zToMuMuMC ,
   backgroundHistos3Jets
 }

path allEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   -zToMuMuMC,
   allHistos4Jets   
 }

 path signalEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   zToMuMuMC, 
   signalHistos4Jets
 } 

 path backgroundEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   !zToMuMuMC ,
   backgroundHistos4Jets
 }

path allEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   -zToMuMuMC,
   allHistos5Jets   
 }

 path signalEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   zToMuMuMC, 
   signalHistos5Jets
 } 

 path backgroundEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   !zToMuMuMC,
   backgroundHistos5Jets
 }

path allEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   -zToMuMuMC,
   allHistosMoreThan5Jets   
 }

 path signalEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   zToMuMuMC, 
   signalHistosMoreThan5Jets
 } 

 path backgroundEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   !zToMuMuMC,
   backgroundHistosMoreThan5Jets
 }

}


# endpath o ={ out  }
}
