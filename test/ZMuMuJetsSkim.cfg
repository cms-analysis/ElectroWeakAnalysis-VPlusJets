 process SUBSKIM = {
  include "FWCore/MessageLogger/data/MessageLogger.cfi"
  include "Configuration/EventContent/data/EventContent.cff"
  include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates2GenParticles.cfi"
  include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

  untracked PSet maxEvents = { untracked int32 input = -1 }

 source = PoolSource {
   untracked vstring fileNames = {
"file:/data/cmsdata/zplusjets/skimZMuMuJets1NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets2NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets3NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets4NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets5NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets6NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets7NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets8NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets9NoMCuts.root",
"file:/data/cmsdata/zplusjets/skimZMuMuJets10NoMCuts.root"

  }
 }

 module SKIM = PoolOutputModule {
  untracked string fileName = "file:/data/cmsdata/zplusjets/ZMuMuJets1.root"
  untracked vstring outputCommands = {
              "drop *",

## Collections stored              
 	     "keep *_zToMuMu_*_*",
             "keep *_muons_*_*",
             "keep *_iterativeCone5CaloJets_*_*",
             "keep *_ctfWithMaterialTracks_*_*",             
             "keep recoCaloMETs_met_*_Rec1",
             "keep *_standAloneMuons__*",
             
##MC Productions
             "keep *_zToMuMuMC_*_*",
             "keep *_genParticles_*_*",
             "keep *_leadingPartons_*_*",
             "keep *_iterativeCone5GenJetsNoNuBSM_*_*",
             "keep *_genMetNoNuBSM_*_*",
             "keep *_csaweightproducer_*_*",
             "keep *_selectedGenJets_*_*",
             "keep *_isolatedGenJets_*_*",
             "keep *_matchedGenJets_*_*",
             "keep *_matchedCaloJets_*_*",
             "keep *_selectedPartons_*_*",
         
##Collections that survive the cuts
             "keep *_selectedMuons_*_*",
             "keep *_selectedCaloJets_*_*",
             "keep *_isolatedCaloJets_*_*"
        
	     }
untracked PSet SelectEvents = {
    vstring SelectEvents = {
     "dataSelection"
    }
  }


  }

   module zToMuMu = CandViewShallowCloneCombiner {
   string decay = "selectedMuons@+ selectedMuons@-"
   string cut = "mass > 5"
   bool filter = true
 }

module zToMuMuMC = CandViewRefSelector {
   InputTag src = genParticles
  string cut = "pdgId=23 & status=3 & numberOfDaughters>0 & abs(daughter(0).pdgId)=13"
   bool filter = true
 }

module selectedMuons = CandViewRefSelector {
   InputTag src = muons
   string cut = "pt > 15 & abs(eta)<3"
   bool filter = true
 }

 module selectedCaloJets = CandViewRefSelector {
   InputTag src = iterativeCone5CaloJets
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module selectedGenJets = CandViewRefSelector {
   InputTag src = iterativeCone5GenJetsNoNuBSM
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }
            
module selectedPartons = CandViewRefSelector {
   InputTag src = leadingPartons
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module leadingPartons =  ZMuMuJetsLeadingPartonProducer {
   InputTag src = genParticles
 }
        
 module isolatedCaloJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = selectedMuons
 InputTag jets = selectedCaloJets
 string name = "isolatedCaloJets"
 double deltar = 0.3


}

 module isolatedGenJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = muons
 InputTag jets = selectedGenJets
  string name = "isolatedGenJets"
 double deltar = 0.3

}

module matchedGenJets = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons
   InputTag jets = isolatedGenJets
   string name = "matchedGenJets"
 }

 module matchedCaloJets = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons
   InputTag jets = iterativeCone5CaloJets
   string name = "matchedCaloJets"
 }


 module csaweightproducer = CSA07EventWeightProducer {
    InputTag src = source


    # verbosity
    untracked bool talkToMe = false  #true

    # overall luminosity normalization  (in pb-1)
    double overallLumi = 10.
 }

  module printEventNumber = AsciiOutputModule { }

  module muonsCount = CandViewCountFilter {
  InputTag src = muons
    uint32 minNumber = 2
  }

  path dataSelection = { muonsCount  }

  path MC = {
  genParticles,
  -zToMuMuMC,
  leadingPartons,
  selectedPartons,
  selectedGenJets,  
  isolatedGenJets,
  matchedGenJets,
  matchedCaloJets
  -csaweightproducer
  
  }

  path Cuts = {
  selectedMuons,
  selectedCaloJets,
  isolatedCaloJets
  zToMuMu
  }


  endpath out = { SKIM, printEventNumber }
}


