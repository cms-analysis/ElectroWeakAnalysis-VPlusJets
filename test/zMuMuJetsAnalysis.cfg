 process ZMuMuJetsAnalysis = {

include "FWCore/MessageLogger/data/MessageLogger.cfi"
include "PhysicsTools/HepMCCandAlgos/data/genParticleCandidates2GenParticles.cfi"
include "SimGeneral/HepPDTESSource/data/pythiapdt.cfi"

untracked PSet options = {
  untracked bool wantSummary = true  # default is false
}

service = TFileService { 
    string fileName = "ZMuMuJetsHistosFile.root"
}

 untracked PSet maxEvents = { 
     untracked int32 input = 10
	}

 source = PoolSource {
    untracked vstring fileNames = {

"rfio:/store/CSA07/2007/12/3/CSA07-CSA07Muon-Tier0-A4-Chowder/0016/062CDBDF-6AA1-DC11-8E93-001617C3B5D8.root"

  
  }
 }


#module partonFilterMin = CandViewCountFilter {
#  InputTag src = selectedPartons
#  uint32 minNumber = 1
#}

#module partonFilterMax = CandViewCountFilter {
#  InputTag src = selectedPartons
#  uint32 minNumber = 2
#}

module muonFilter = CandViewCountFilter {
  InputTag src = muons
  uint32 minNumber = 2
}

module muonFilter2 = CandViewCountFilter {
  InputTag src = muons
  uint32 minNumber = 3
}

 module zToMuMu = CandViewShallowCloneCombiner {
   string decay = "muons@+ muons@-"
   string cut = "5<mass<200"
}

module selectedMuons = CandViewRefSelector {
   InputTag src = muons
   string cut = "pt > 15 & abs(eta)<3"
   bool filter = true
 }

 module selectedCaloJets = CandViewRefSelector {
   InputTag src = iterativeCone5CaloJets
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module selectedGenJets = CandViewRefSelector {
   InputTag src = iterativeCone5GenJetsNoNuBSM
  string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }	

module selectedPartons = CandViewRefSelector {
   InputTag src = leadingPartons
   string cut = "pt > 30 & abs(eta)<3"
   bool filter = true
 }

 module zToMuMuMC = CandViewRefSelector {
   InputTag src = genParticles
   string cut = "pdgId=23 & status=3 & numberOfDaughters>0 & abs(daughter(0).pdgId)=13"
   bool filter = true
 }
 
  module leadingPartons =  ZMuMuJetsLeadingPartonProducer {
   InputTag src = genParticles
 }
 
 module matchedGenJets = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons 
   InputTag jets = isolatedGenJets
   string name = "matchedGenJets"
 }
 
 module matchedCaloJets = ZMuMuJetsMatchedJetsProducer {
   InputTag partons = selectedPartons
   InputTag jets = isolatedCaloJets
   string name = "matchedCaloJets"
 }
 
 module isolatedCaloJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = muons
 InputTag jets = selectedCaloJets
 string name = "isolatedCaloJets"
 double deltar = 0.3

}

 module isolatedGenJets = ZMuMuJetsIsolatedJetsProducer {
 InputTag muons = muons
 InputTag jets = selectedGenJets
 string name = "isolatedGenJets"
 double deltar = 0.3

}

module moreThan0Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 1 
}

module moreThan1Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 2 
}

module moreThan2Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 3 
}

module moreThan3Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 4 
}

module moreThan4Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 5 
}

module moreThan5Jets = CandViewCountFilter {
  InputTag src = isolatedCaloJets
  uint32 minNumber = 6 
}

#module printTree = ParticleTreeDrawer {

#    untracked bool printP4 = true
#    untracked bool printPtEtaPhi = false
#    untracked bool printVertex = false
#    untracked bool printStatus = false
#    untracked bool printIndex = false
#    untracked vint32 status = { 3 }
# }

module allHistos = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos1Jet = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos1Jet = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos1Jet = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos2Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos2Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos2Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos3Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos3Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos3Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos4Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos4Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos4Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistos5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistos5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistos5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module allHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag genJets = isolatedGenJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module signalHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag genJets = isolatedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

module backgroundHistosMoreThan5Jets = zMuMuJetsHistogrammer {
  InputTag partons = selectedPartons
  InputTag caloJets = isolatedCaloJets
  InputTag matchedCaloJets = matchedCaloJets
  InputTag matchedGenJets = matchedGenJets
  InputTag genJets = isolatedGenJets
  InputTag muons = muons
  InputTag z = zToMuMu
  InputTag zMC = zToMuMuMC
}

sequence preselection = {
  -genParticles,
   muonFilter,
  -muonFilter2,  
  -selectedMuons,
  #leadingPartons,
  -selectedPartons,
  -selectedCaloJets,
  -isolatedCaloJets,
  -selectedGenJets,
  -isolatedGenJets, 
  -matchedGenJets,
  -matchedCaloJets,
 # printTree,
  -zToMuMu     

}

 path allEntries = {
   preselection,
   -zToMuMuMC,
   allHistos   
 }

 path signalEntries = {
   preselection,
   zToMuMuMC, 
   signalHistos
 } 

 path backgroundEntries = {
   preselection,
   !zToMuMuMC, 
   backgroundHistos
 } 


 path allEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   -zToMuMuMC,
    allHistos1Jet   
 }

 path signalEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   zToMuMuMC, 
   signalHistos1Jet
 } 

 path backgroundEntries1Jet = {
   preselection,
   moreThan0Jets&
   !moreThan1Jets&
   !zToMuMuMC, 
   backgroundHistos1Jet
 } 

path allEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   -zToMuMuMC,
   allHistos2Jets   
 }

 path signalEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   zToMuMuMC, 
   signalHistos2Jets
 } 

 path backgroundEntries2Jets = {
   preselection,
   moreThan1Jets&
   !moreThan2Jets&
   !zToMuMuMC, 
   backgroundHistos2Jets
 }

path allEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   -zToMuMuMC,
   allHistos3Jets   
 }

 path signalEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   zToMuMuMC, 
   signalHistos3Jets
 } 

 path backgroundEntries3Jets = {
   preselection,
   moreThan2Jets&
   !moreThan3Jets&
   !zToMuMuMC ,
   backgroundHistos3Jets
 }

path allEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   -zToMuMuMC,
   allHistos4Jets   
 }

 path signalEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   zToMuMuMC, 
   signalHistos4Jets
 } 

 path backgroundEntries4Jets = {
   preselection,
   moreThan3Jets&
   !moreThan4Jets&
   !zToMuMuMC ,
   backgroundHistos4Jets
 }

path allEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   -zToMuMuMC,
   allHistos5Jets   
 }

 path signalEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   zToMuMuMC, 
   signalHistos5Jets
 } 

 path backgroundEntries5Jets = {
   preselection,
   moreThan4Jets&
   !moreThan5Jets&
   !zToMuMuMC,
   backgroundHistos5Jets
 }

path allEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   -zToMuMuMC,
   allHistosMoreThan5Jets   
 }

 path signalEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   zToMuMuMC, 
   signalHistosMoreThan5Jets
 } 

 path backgroundEntriesMoreThan5Jets = {
   preselection,
   moreThan5Jets&
   !zToMuMuMC,
   backgroundHistosMoreThan5Jets
 }

}


# endpath o ={ out  }
}
